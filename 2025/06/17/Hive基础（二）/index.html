<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Hive环境搭建参考之前搭建Hadoop环境，依旧基于docker-compose来搭建Hadoop+Hive环境。 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475">
<meta property="og:type" content="article">
<meta property="og:title" content="Hive基础（二）">
<meta property="og:url" content="https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/index.html">
<meta property="og:site_name" content="H3rmesk1t&#39;s Blog">
<meta property="og:description" content="Hive环境搭建参考之前搭建Hadoop环境，依旧基于docker-compose来搭建Hadoop+Hive环境。 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/1750144322252-fbc0b121-6c82-4de9-817d-27ff1e3d22e7.png">
<meta property="og:image" content="https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/1750144538716-453421f9-158c-4a5b-bd81-ad6fd46c55f4.png">
<meta property="og:image" content="https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/1750161580514-ebb1039a-60ec-4d9d-a495-628ba42be23d.png">
<meta property="og:image" content="https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/1750162740273-576b6f80-326f-4660-a48c-d2121bfb214e.png">
<meta property="og:image" content="https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/1750162789438-d373eb41-e844-4179-96cc-e3a37506b517.png">
<meta property="article:published_time" content="2025-06-17T12:25:00.000Z">
<meta property="article:modified_time" content="2025-06-17T12:24:50.348Z">
<meta property="article:author" content="H3rmesk1t">
<meta property="article:tag" content="大数据">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/1750144322252-fbc0b121-6c82-4de9-817d-27ff1e3d22e7.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/my-logo.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/my-logo-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/my-logo.png">
        
      
    
    <!-- title -->
    <title>Hive基础（二）</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="H3rmesk1t&#39;s Blog" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/06/16/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B8%80%EF%BC%89/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&text=Hive基础（二）"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&title=Hive基础（二）"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&is_video=false&description=Hive基础（二）"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Hive基础（二）&body=Check out this article: https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&title=Hive基础（二）"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&title=Hive基础（二）"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&title=Hive基础（二）"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&title=Hive基础（二）"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&name=Hive基础（二）&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&t=Hive基础（二）"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.</span> <span class="toc-text">Hive环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E5%B8%B8%E7%94%A8DDL%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.</span> <span class="toc-text">Hive常用DDL语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">2.1.</span> <span class="toc-text">数据库操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.</span> <span class="toc-text">表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E8%A1%A8"><span class="toc-number">2.2.1.</span> <span class="toc-text">内部表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E8%A1%A8"><span class="toc-number">2.2.2.</span> <span class="toc-text">外部表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E8%A1%A8"><span class="toc-number">2.2.3.</span> <span class="toc-text">分区表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%A1%B6%E8%A1%A8"><span class="toc-number">2.2.4.</span> <span class="toc-text">分桶表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%80%BE%E6%96%9C%E8%A1%A8"><span class="toc-number">2.2.5.</span> <span class="toc-text">倾斜表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E8%A1%A8"><span class="toc-number">2.2.6.</span> <span class="toc-text">临时表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.7.</span> <span class="toc-text">复制表结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CTAS%E5%BB%BA%E8%A1%A8"><span class="toc-number">2.2.8.</span> <span class="toc-text">CTAS建表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">2.2.9.</span> <span class="toc-text">修改删除表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.10.</span> <span class="toc-text">加载数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.11.</span> <span class="toc-text">导出数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E5%B8%B8%E7%94%A8DQL%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.</span> <span class="toc-text">Hive常用DQL语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.1.</span> <span class="toc-text">单表查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.2.</span> <span class="toc-text">多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#INNER-JOIN"><span class="toc-number">3.2.1.</span> <span class="toc-text">INNER JOIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LEFT-OUTER-JOIN"><span class="toc-number">3.2.2.</span> <span class="toc-text">LEFT OUTER JOIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RIGHT-OUTER-JOIN"><span class="toc-number">3.2.3.</span> <span class="toc-text">RIGHT OUTER JOIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FULL-OUTER-JOIN"><span class="toc-number">3.2.4.</span> <span class="toc-text">FULL OUTER JOIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LEFT-SEMI-JOIN"><span class="toc-number">3.2.5.</span> <span class="toc-text">LEFT SEMI JOIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JOIN"><span class="toc-number">3.2.6.</span> <span class="toc-text">JOIN</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.3.</span> <span class="toc-text">本地模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Hive基础（二）
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">H3rmesk1t</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-06-17T12:25:00.000Z" class="dt-published" itemprop="datePublished">2025-06-17</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="Hive环境搭建"><a href="#Hive环境搭建" class="headerlink" title="Hive环境搭建"></a>Hive环境搭建</h2><p>参考之前搭建Hadoop环境，依旧基于docker-compose来搭建Hadoop+Hive环境。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">namenode:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bde2020/hadoop-namenode</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">namenode</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9870</span><span class="string">:9870</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9000</span><span class="string">:9000</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">&quot;always&quot;</span></span><br><span class="line">    <span class="comment"># volumes:</span></span><br><span class="line">    <span class="comment">#   - &quot;hadoop_datanode:/hadoop/dfs/name&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">CLUSTER_NAME:</span> <span class="string">&quot;docker-hadoop-cluster&quot;</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./env.env</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">datanode:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bde2020/hadoop-datanode</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">datanode</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namenode</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9864</span><span class="string">:9864</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">&quot;always&quot;</span></span><br><span class="line">    <span class="comment"># volumes:</span></span><br><span class="line">    <span class="comment">#   - &quot;hadoop_datanode:/hadoop/dfs/data&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">SERVICE_PRECONDITION:</span> <span class="string">&quot;namenode:9870&quot;</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;namenode:namenode&quot;</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./env.env</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">resourcemanager:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bde2020/hadoop-resourcemanager</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">resourcemanager</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8088</span><span class="string">:8088</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;namenode:namenode&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;datanode:datanode&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namenode</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">datanode</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">&quot;always&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">SERVICE_PRECONDITION:</span> <span class="string">&quot;namenode:9000 namenode:9870 datanode:9864&quot;</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./env.env</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nodemanager:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bde2020/hadoop-nodemanager</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nodemanager</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;namenode:namenode&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;datanode:datanode&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;resourcemanager:resourcemanager&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namenode</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">datanode</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">resourcemanager</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">&quot;always&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">SERVICE_PRECONDITION:</span> <span class="string">&quot;namenode:9000 namenode:9870 datanode:9864 resourcemanager:8088&quot;</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./env.env</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">historyserver:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bde2020/hadoop-historyserver</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">historyserver</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;namenode:namenode&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;datanode:datanode&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;resourcemanager:resourcemanager&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namenode</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">datanode</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">resourcemanager</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">&quot;always&quot;</span></span><br><span class="line">    <span class="comment"># volumes:</span></span><br><span class="line">    <span class="comment">#   - &quot;hadoop_historyserver:/hadoop/yarn/timeline&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">SERVICE_PRECONDITION:</span> <span class="string">&quot;namenode:9000 namenode:9870 datanode:9864 resourcemanager:8088&quot;</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./env.env</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">hive-metastore-postgresql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bde2020/hive-metastore-postgresql:2.3.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hive-metastore-postgresql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">&quot;always&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5432:5432&quot;</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">hive-metastore:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bde2020/hive:2.3.2-postgresql-metastore</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hive-metastore</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./env.env</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">/opt/hive/bin/hive</span> <span class="string">--service</span> <span class="string">metastore</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;namenode:namenode&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;datanode:datanode&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;hive-metastore-postgresql:hive-metastore-postgresql&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namenode</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">datanode</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hive-metastore-postgresql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">&quot;always&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">SERVICE_PRECONDITION:</span> <span class="string">&quot;namenode:9870 datanode:9864 hive-metastore-postgresql:5432&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9083:9083&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">hive-server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bde2020/hive:2.3.2-postgresql-metastore</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hive-server</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./env.env</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;hive-metastore:hive-metastore&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;hive-metastore-postgresql:hive-metastore-postgresql&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hive-metastore</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hive-metastore-postgresql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">&quot;always&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">SERVICE_PRECONDITION:</span> <span class="string">&quot;hive-metastore:9083 hive-metastore-postgresql:5432&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;10000:10000&quot;</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">presto:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">shawnzhu/prestodb:0.181</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">presto</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># volumes:</span></span><br><span class="line"><span class="comment">#   hadoop_namenode:</span></span><br><span class="line"><span class="comment">#   hadoop_datanode:</span></span><br><span class="line"><span class="comment">#   hadoop_historyserver:</span></span><br></pre></td></tr></table></figure>

<pre><code>进入Hive命令行操作。
</code></pre>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it hive-server bash</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test(</span><br><span class="line">  id      <span class="type">int</span></span><br><span class="line">  ,name    string</span><br><span class="line">  )</span><br><span class="line">  <span class="type">row</span> format delimited</span><br><span class="line">  fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line"></span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/tmp/test.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/1750144322252-fbc0b121-6c82-4de9-817d-27ff1e3d22e7.png"></p>
<p>利用DataGrip等工具进行操作。</p>
<p><img src="/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/1750144538716-453421f9-158c-4a5b-bd81-ad6fd46c55f4.png"></p>
<h2 id="Hive常用DDL语句"><a href="#Hive常用DDL语句" class="headerlink" title="Hive常用DDL语句"></a>Hive常用DDL语句</h2><h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">-- 查看数据列表</span><br><span class="line">SHOW DATABASES;</span><br><span class="line">-- 使用数据库</span><br><span class="line">USE database_name;</span><br><span class="line"></span><br><span class="line">-- 创建数据库</span><br><span class="line">CREATE (DATABASE|SCHEMA) [IF NOT EXISTS] database_name   --DATABASE|SCHEMA 是等价的</span><br><span class="line">  [COMMENT database_comment] --数据库注释</span><br><span class="line">  [LOCATION hdfs_path] --存储在 HDFS 上的位置</span><br><span class="line">  [WITH DBPROPERTIES (property_name=property_value, ...)]; --指定额外属性</span><br><span class="line">-- 示例</span><br><span class="line">CREATE DATABASE IF NOT EXISTS hive_test</span><br><span class="line">  COMMENT &#x27;hive database for test&#x27;</span><br><span class="line">  LOCATION &#x27;/hive_test&#x27;</span><br><span class="line">  WITH DBPROPERTIES (&#x27;creater&#x27;=&#x27;H3rmesk1t&#x27;);</span><br><span class="line"></span><br><span class="line">-- 修改数据库, 可以使用ALTER DATABASE命令来修改数据库的一些属性, 但是数据库的元数据信息是不可更改的, 包括数据库的名称以及数据库所在的位置</span><br><span class="line">ALTER DATABASE test_hive set dbproperties(&#x27;createtime&#x27;=&#x27;20260617&#x27;);</span><br><span class="line"></span><br><span class="line">-- 查看数据库信息</span><br><span class="line">DESC DATABASE [EXTENDED] db_name; --EXTENDED 表示是否显示额外属性</span><br><span class="line">-- 示例</span><br><span class="line">DESC DATABASE EXTENDED hive_test;</span><br><span class="line"></span><br><span class="line">-- 删除数据库</span><br><span class="line">DROP (DATABASE|SCHEMA) [IF EXISTS] database_name [RESTRICT|CASCADE];</span><br><span class="line">-- 默认行为是RESTRICT, 如果数据库中存在表则删除失败</span><br><span class="line">-- 要想删除库及其中的表, 可以使用CASCADE级联删除</span><br><span class="line">-- 示例</span><br><span class="line">drop database demohive cascade; </span><br></pre></td></tr></table></figure>

<h3 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- 建表语法</span><br><span class="line">CREATE [TEMPORARY] [EXTERNAL] TABLE [IF NOT EXISTS] [db_name.]table_name     --表名</span><br><span class="line">  [(col_name data_type [COMMENT col_comment],</span><br><span class="line">    ... [constraint_specification])]  --列名 列数据类型</span><br><span class="line">  [COMMENT table_comment]   --表描述</span><br><span class="line">  [PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)]  --分区表分区规则</span><br><span class="line">  [</span><br><span class="line">    CLUSTERED BY (col_name, col_name, ...)</span><br><span class="line">   [SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS</span><br><span class="line">  ]  --分桶表分桶规则</span><br><span class="line">  [SKEWED BY (col_name, col_name, ...) ON ((col_value, col_value, ...), (col_value, col_value, ...), ...)</span><br><span class="line">   [STORED AS DIRECTORIES]</span><br><span class="line">  ]  --指定倾斜列和值</span><br><span class="line">  [</span><br><span class="line">   [ROW FORMAT row_format]</span><br><span class="line">   [STORED AS file_format]</span><br><span class="line">     | STORED BY &#x27;storage.handler.class.name&#x27; [WITH SERDEPROPERTIES (...)]</span><br><span class="line">  ]  -- 指定行分隔符、存储文件格式或采用自定义存储格式</span><br><span class="line">  [LOCATION hdfs_path]  -- 指定表的存储位置</span><br><span class="line">  [TBLPROPERTIES (property_name=property_value, ...)]  --指定表的属性</span><br><span class="line">  [AS select_statement];   --从查询结果创建表</span><br></pre></td></tr></table></figure>

<h4 id="内部表"><a href="#内部表" class="headerlink" title="内部表"></a>内部表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- 内部表建表示例</span><br><span class="line">CREATE TABLE emp(</span><br><span class="line">  empno INT,</span><br><span class="line">  ename STRING,</span><br><span class="line">  job STRING,</span><br><span class="line">  mgr INT,</span><br><span class="line">  hiredate TIMESTAMP,</span><br><span class="line">  sal DECIMAL(7,2),</span><br><span class="line">  comm DECIMAL(7,2),</span><br><span class="line">  deptno INT)</span><br><span class="line">  ROW FORMAT DELIMITED FIELDS TERMINATED BY &quot;\t&quot;;</span><br></pre></td></tr></table></figure>

<h4 id="外部表"><a href="#外部表" class="headerlink" title="外部表"></a>外部表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-- 外部表建表示例</span><br><span class="line">CREATE EXTERNAL TABLE emp_external(</span><br><span class="line">  empno INT,</span><br><span class="line">  ename STRING,</span><br><span class="line">  job STRING,</span><br><span class="line">  mgr INT,</span><br><span class="line">  hiredate TIMESTAMP,</span><br><span class="line">  sal DECIMAL(7,2),</span><br><span class="line">  comm DECIMAL(7,2),</span><br><span class="line">  deptno INT)</span><br><span class="line">  ROW FORMAT DELIMITED FIELDS TERMINATED BY &quot;\t&quot;</span><br><span class="line">  LOCATION &#x27;/hive/emp_external&#x27;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-- 从本地文件系统向表中加载数据</span><br><span class="line">-- 追加操作</span><br><span class="line">load data local inpath &#x27;/export/servers/hivedatas/emp.csv&#x27; into table emp_external;</span><br><span class="line">-- 覆盖操作</span><br><span class="line">load data local inpath &#x27;/export/servers/hivedatas/emp.csv&#x27; overwrite into table emp_external;</span><br><span class="line"></span><br><span class="line">-- 使用load data local表示从本地文件系统加载, 文件会拷贝到hdfs上</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 从hdfs文件系统向表中加载数据</span><br><span class="line">load data inpath &#x27;/hivedatas/emp.csv&#x27; into table emp_external;</span><br><span class="line">-- 加载数据到指定分区</span><br><span class="line">load data inpath &#x27;/hivedatas/emp.csv&#x27; into table emp_external partition(cur_date=20250617);</span><br><span class="line"></span><br><span class="line">-- 使用load data表示从hdfs文件系统加载, 文件会直接移动到hive相关目录下, 注意不是拷贝过去, 因为hive认为hdfs文件已经有3副本了, 没必要再次拷贝</span><br></pre></td></tr></table></figure>

<h4 id="分区表"><a href="#分区表" class="headerlink" title="分区表"></a>分区表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- 分区表建表示例</span><br><span class="line">CREATE EXTERNAL TABLE emp_partition(</span><br><span class="line">  empno INT,</span><br><span class="line">  ename STRING,</span><br><span class="line">  job STRING,</span><br><span class="line">  mgr INT,</span><br><span class="line">  hiredate TIMESTAMP,</span><br><span class="line">  sal DECIMAL(7,2),</span><br><span class="line">  comm DECIMAL(7,2)</span><br><span class="line">  )</span><br><span class="line">  PARTITIONED BY (deptno INT)   -- 按照部门编号进行分区</span><br><span class="line">  ROW FORMAT DELIMITED FIELDS TERMINATED BY &quot;\t&quot;</span><br><span class="line">  LOCATION &#x27;/hive/emp_partition&#x27;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-- 加载数据到一个分区的表中</span><br><span class="line">load data local inpath &#x27;/export/servers/hivedatas/emp.csv&#x27; into table emp_partition partition (month=&#x27;201806&#x27;);</span><br><span class="line">-- 加载数据到一个多分区的表中去</span><br><span class="line">load data local inpath &#x27;/export/servers/hivedatas/emp.csv&#x27; into table emp_partition partition(year=&#x27;2018&#x27;,month=&#x27;06&#x27;,day=&#x27;01&#x27;);</span><br><span class="line">-- 查看分区</span><br><span class="line">show partitions emp;</span><br><span class="line">-- 添加一个分区</span><br><span class="line">alter table score add partition(month=&#x27;201805&#x27;);</span><br><span class="line">-- 同时添加多个分区</span><br><span class="line">alter table score add partition(month=&#x27;201804&#x27;) partition(month=&#x27;201803&#x27;);</span><br><span class="line">-- 删除分区</span><br><span class="line">alter table score drop partition(month=&#x27;201806&#x27;);</span><br><span class="line"></span><br><span class="line">-- 添加分区之后就可以在hdfs文件系统当中看到表下面多了一个文件夹</span><br><span class="line">-- hive表创建的时候可以用location指定一个文件或者文件夹, 当指定文件夹时, hive会加载文件夹下的所有文件; 当表中无分区时, 这个文件夹下不能再有文件夹, 否则报错</span><br><span class="line">-- 当表是分区表时, 比如partitioned by (day string), 则这个文件夹下的每一个文件夹就是一个分区</span><br></pre></td></tr></table></figure>

<h4 id="分桶表"><a href="#分桶表" class="headerlink" title="分桶表"></a>分桶表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- 分桶表建表示例</span><br><span class="line">CREATE EXTERNAL TABLE emp_bucket(</span><br><span class="line">  empno INT,</span><br><span class="line">  ename STRING,</span><br><span class="line">  job STRING,</span><br><span class="line">  mgr INT,</span><br><span class="line">  hiredate TIMESTAMP,</span><br><span class="line">  sal DECIMAL(7,2),</span><br><span class="line">  comm DECIMAL(7,2),</span><br><span class="line">  deptno INT)</span><br><span class="line">  CLUSTERED BY(empno) SORTED BY(empno ASC) INTO 4 BUCKETS  --按照员工编号散列到四个 bucket 中</span><br><span class="line">  ROW FORMAT DELIMITED FIELDS TERMINATED BY &quot;\t&quot;</span><br><span class="line">  LOCATION &#x27;/hive/emp_bucket&#x27;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 桶表中加载数据</span><br><span class="line">insert overwrite table emp_bucket select * from emp_common cluster by(c_id);  -- 最后指定桶字段</span><br><span class="line"></span><br><span class="line">-- 由于桶表无法通过hdfs dfs -put 文件或者通过load data加载数据, 只能通过insert overwrite进行加载</span><br><span class="line">-- 所以把文件加载到桶表中, 需要先创建普通表并通过insert overwrite的方式将普通表的数据通过查询的方式加载到桶表当中去</span><br></pre></td></tr></table></figure>

<h4 id="倾斜表"><a href="#倾斜表" class="headerlink" title="倾斜表"></a>倾斜表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-- 倾斜表建表示例</span><br><span class="line">-- 通过指定一个或者多个列经常出现的值(严重偏斜), Hive 会自动将涉及到这些值的数据拆分为单独的文件; 在查询时如果涉及到倾斜值, 它就直接从独立文件中获取数据, 而不是扫描所有文件, 这使得性能得到提升</span><br><span class="line">CREATE EXTERNAL TABLE emp_skewed(</span><br><span class="line">  empno INT,</span><br><span class="line">  ename STRING,</span><br><span class="line">  job STRING,</span><br><span class="line">  mgr INT,</span><br><span class="line">  hiredate TIMESTAMP,</span><br><span class="line">  sal DECIMAL(7,2),</span><br><span class="line">  comm DECIMAL(7,2)</span><br><span class="line">  )</span><br><span class="line">  SKEWED BY (empno) ON (66,88,100)  --指定 empno 的倾斜值 66,88,100</span><br><span class="line">  ROW FORMAT DELIMITED FIELDS TERMINATED BY &quot;\t&quot;</span><br><span class="line">  LOCATION &#x27;/hive/emp_skewed&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="临时表"><a href="#临时表" class="headerlink" title="临时表"></a>临时表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-- 临时表建表示例</span><br><span class="line">-- 临时表仅对当前Session可见, 临时表的数据将存储在用户的暂存目录中, 并在会话结束后删除</span><br><span class="line">-- 如果临时表与永久表表名相同, 则对该表名的任何引用都将解析为临时表, 而不是永久表</span><br><span class="line">-- 临时表还具有以下两个限制: 不支持分区列, 不支持创建索引</span><br><span class="line">CREATE TEMPORARY TABLE emp_temp(</span><br><span class="line">  empno INT,</span><br><span class="line">  ename STRING,</span><br><span class="line">  job STRING,</span><br><span class="line">  mgr INT,</span><br><span class="line">  hiredate TIMESTAMP,</span><br><span class="line">  sal DECIMAL(7,2),</span><br><span class="line">  comm DECIMAL(7,2)</span><br><span class="line">  )</span><br><span class="line">  ROW FORMAT DELIMITED FIELDS TERMINATED BY &quot;\t&quot;;</span><br></pre></td></tr></table></figure>

<h4 id="复制表结构"><a href="#复制表结构" class="headerlink" title="复制表结构"></a>复制表结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE [TEMPORARY] [EXTERNAL] TABLE [IF NOT EXISTS] [db_name.]table_name  --创建表表名</span><br><span class="line">   LIKE existing_table_or_view_name  --被复制表的表名</span><br><span class="line">   [LOCATION hdfs_path]; --存储位置</span><br><span class="line"></span><br><span class="line">-- 示例</span><br><span class="line">CREATE TEMPORARY EXTERNAL TABLE IF NOT EXISTS emp_co LIKE emp</span><br></pre></td></tr></table></figure>

<h4 id="CTAS建表"><a href="#CTAS建表" class="headerlink" title="CTAS建表"></a>CTAS建表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- Hive支持从查询语句的结果创建表</span><br><span class="line">CREATE TABLE emp_copy AS SELECT * FROM emp WHERE deptno=&#x27;20&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="修改删除表"><a href="#修改删除表" class="headerlink" title="修改删除表"></a>修改删除表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-- 修改表名称</span><br><span class="line">ALTER TABLE table_name RENAME TO new_table_name;</span><br><span class="line"></span><br><span class="line">-- 修改列信息</span><br><span class="line">ALTER TABLE table_name [PARTITION partition_spec] CHANGE [COLUMN] col_old_name col_new_name column_type</span><br><span class="line">  [COMMENT col_comment] [FIRST|AFTER column_name] [CASCADE|RESTRICT];</span><br><span class="line">-- 示例</span><br><span class="line">-- 修改字段名和类型</span><br><span class="line">ALTER TABLE emp_temp CHANGE empno empno_new INT;</span><br><span class="line">-- 修改字段sal的名称, 并将其放置到empno字段后</span><br><span class="line">ALTER TABLE emp_temp CHANGE sal sal_new decimal(7,2) AFTER ename;</span><br><span class="line">-- 为字段增加注释</span><br><span class="line">ALTER TABLE emp_temp CHANGE mgr mgr_new INT COMMENT &#x27;this is column mgr&#x27;;</span><br><span class="line"></span><br><span class="line">-- 增加列信息</span><br><span class="line">ALTER TABLE emp_temp ADD COLUMNS (address STRING COMMENT &#x27;home address&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 删除表</span><br><span class="line">drop table score;</span><br><span class="line">-- 清空表, 只能清空管理表, 也就是内部表, 清空外部表会产生错误</span><br><span class="line">truncate table score;</span><br><span class="line">-- 如果hdfs开启了回收站, drop删除的表数据是可以从回收站恢复的, 表结构恢复不了, 需要自己重新创建; truncate清空的表是不进回收站的, 所以无法恢复truncate清空的表</span><br></pre></td></tr></table></figure>

<h4 id="加载数据"><a href="#加载数据" class="headerlink" title="加载数据"></a>加载数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-- 直接向分区表中插入数据</span><br><span class="line">insert into table score partition(month=&#x27;201807&#x27;) values (&#x27;001&#x27;,&#x27;002&#x27;,&#x27;100&#x27;);</span><br><span class="line"></span><br><span class="line">-- 通过load方式加载数据</span><br><span class="line">load data local inpath &#x27;/export/servers/hivedatas/score.csv&#x27; overwrite into table score partition(month=&#x27;201806&#x27;);</span><br><span class="line"></span><br><span class="line">-- 通过查询方式加载数据</span><br><span class="line">insert overwrite table score2 partition(month=&#x27;201806&#x27;) select s_id,c_id,s_score from score1;</span><br><span class="line"></span><br><span class="line">-- 查询语句中创建表并加载数据</span><br><span class="line">create table score2 as select * from score1;</span><br><span class="line"></span><br><span class="line">-- 在创建表是通过location指定加载数据的路径</span><br><span class="line">create external table score6 (s_id string,c_id string,s_score int) row format delimited fields terminated by &#x27;,&#x27; location &#x27;/myscore&#x27;;</span><br><span class="line"></span><br><span class="line">-- export导出与import导入hive表数据(内部表操作)</span><br><span class="line">create table techer2 like techer; --依据已有表结构创建表</span><br><span class="line">export table techer to &#x27;/export/techer&#x27;;</span><br><span class="line">import table techer2 from &#x27;/export/techer&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="导出数据"><a href="#导出数据" class="headerlink" title="导出数据"></a>导出数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-- 将查询的结果导出到本地</span><br><span class="line">insert overwrite local directory &#x27;/export/servers/exporthive&#x27; select * from score;</span><br><span class="line"></span><br><span class="line">-- 将查询的结果格式化导出到本地</span><br><span class="line">insert overwrite local directory &#x27;/export/servers/exporthive&#x27; row format delimited fields terminated by &#x27;\t&#x27; collection items terminated by &#x27;#&#x27; select * from student;</span><br><span class="line"></span><br><span class="line">-- 将查询的结果导出到HDFS上(没有local)</span><br><span class="line">insert overwrite directory &#x27;/export/servers/exporthive&#x27; row format delimited fields terminated by &#x27;\t&#x27; collection items terminated by &#x27;#&#x27; select * from score;</span><br><span class="line"></span><br><span class="line">-- Hadoop命令导出到本地</span><br><span class="line">dfs -get /export/servers/exporthive/000000_0 /export/servers/exporthive/local.txt;</span><br><span class="line"></span><br><span class="line">-- hive shell命令导出, 基本语法: hive -f/-e 执行语句或者脚本 &gt; file</span><br><span class="line">hive -e &quot;select * from myhive.score;&quot; &gt; /export/servers/exporthive/score.txt</span><br><span class="line">hive -f export.sh &gt; /export/servers/exporthive/score.txt</span><br><span class="line"></span><br><span class="line">-- export导出到HDFS上</span><br><span class="line">export table score to &#x27;/export/exporthive/score&#x27;;</span><br></pre></td></tr></table></figure>

<h2 id="Hive常用DQL语句"><a href="#Hive常用DQL语句" class="headerlink" title="Hive常用DQL语句"></a>Hive常用DQL语句</h2><h3 id="单表查询"><a href="#单表查询" class="headerlink" title="单表查询"></a>单表查询</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">-- 查询表中全部数据</span><br><span class="line">SELECT * FROM emp;</span><br><span class="line"></span><br><span class="line">-- 查询20号部门中员工编号大于7566的员工信息</span><br><span class="line">SELECT * FROM emp WHERE empno &gt; 7566 AND deptno = 20;</span><br><span class="line"></span><br><span class="line">-- 查询所有工作类型, Hive支持使用DISTINCT关键字去重</span><br><span class="line">SELECT DISTINCT job FROM emp;</span><br><span class="line"></span><br><span class="line">-- 查询分区表中部门编号在[20,40]之间的员工</span><br><span class="line">SELECT emp_ptn.* FROM emp_ptn</span><br><span class="line">WHERE emp_ptn.deptno &gt;= 20 AND emp_ptn.deptno &lt;= 40;</span><br><span class="line"></span><br><span class="line">-- 查询薪资最高的3名员工</span><br><span class="line">SELECT * FROM emp ORDER BY sal DESC LIMIT 3;</span><br><span class="line"></span><br><span class="line">-- 分组聚合查询, 查询各个部门薪酬综合</span><br><span class="line">-- hive.map.aggr控制程序如何进行聚合, 默认值为false, 如果设置为true, Hive会在map阶段就执行一次聚合, 可以提高聚合效率但需要消耗更多内存</span><br><span class="line">set hive.map.aggr=true;</span><br><span class="line">SELECT deptno,SUM(sal) FROM emp GROUP BY deptno;</span><br><span class="line"></span><br><span class="line">-- 使用ORDER BY时会有一个Reducer对全部查询结果进行排序, 可以保证数据的全局有序性</span><br><span class="line">-- 使用SORT BY时只会在每个Reducer中进行排序, 这可以保证每个Reducer的输出数据是有序的, 但不能保证全局有序</span><br><span class="line">-- 由于ORDER BY的时间可能很长, 如果设置了严格模式(hive.mapred.mode = strict), 则其后面必须再跟一个limit子句</span><br><span class="line">-- 查询员工工资, 结果按照部门升序, 按照工资降序排列</span><br><span class="line">SELECT empno, deptno, sal FROM emp ORDER BY deptno ASC, sal DESC;</span><br><span class="line"></span><br><span class="line">-- 使用HAVING对分组数据进行过滤, 查询工资总和大于9000的所有部门</span><br><span class="line">SELECT deptno,SUM(sal) FROM emp GROUP BY deptno HAVING SUM(sal)&gt;9000;</span><br><span class="line"></span><br><span class="line">-- 默认情况下, MapReduce程序会对Map输出结果的Key值进行散列并均匀分发到所有Reducer上</span><br><span class="line">-- 如果想要把具有相同Key值的数据分发到同一个Reducer进行处理, 这就需要使用DISTRIBUTE BY</span><br><span class="line">-- 需要注意的是, DISTRIBUTE BY虽然能保证具有相同Key值的数据分发到同一个Reducer, 但是不能保证数据在Reducer上是有序的, 可以结合SORT BY使用来让Reducer上的数据有序</span><br><span class="line">-- 将数据按照部门分发到对应的Reducer上处理</span><br><span class="line">SELECT empno, deptno, sal FROM emp DISTRIBUTE BY deptno SORT BY deptno ASC;</span><br><span class="line"></span><br><span class="line">-- 如果SORT BY和DISTRIBUTE BY指定的是相同字段, 且SORT BY排序规则是ASC, 此时可以使用CLUSTER BY进行替换, 同时CLUSTER BY可以保证数据在全局是有序的</span><br><span class="line">SELECT empno, deptno, sal FROM emp CLUSTER BY deptno;</span><br></pre></td></tr></table></figure>

<h3 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h3><p>与传统数据库中的概念一致，Hive也支持内连接，外连接，左外连接，右外连接，笛卡尔连接。</p>
<p>需要特别强调，JOIN语句的关联条件必须用ON指定，不能用WHERE指定，否则就会先做笛卡尔积再过滤，会导致得不到预期的结果。</p>
<p><img src="/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/1750161580514-ebb1039a-60ec-4d9d-a495-628ba42be23d.png"></p>
<h4 id="INNER-JOIN"><a href="#INNER-JOIN" class="headerlink" title="INNER JOIN"></a>INNER JOIN</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 查询员工编号为7934的员工的详细信息</span><br><span class="line">SELECT e.*,d.* </span><br><span class="line">FROM emp e JOIN dept d</span><br><span class="line">ON e.deptno = d.deptno</span><br><span class="line">WHERE empno=7934;</span><br><span class="line"></span><br><span class="line">-- 如果是三表或者更多表连接, 语法如下</span><br><span class="line">SELECT a.val, b.val, c.val FROM a JOIN b ON (a.key = b.key1) JOIN c ON (c.key = b.key1)</span><br></pre></td></tr></table></figure>

<h4 id="LEFT-OUTER-JOIN"><a href="#LEFT-OUTER-JOIN" class="headerlink" title="LEFT OUTER JOIN"></a>LEFT OUTER JOIN</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 左连接</span><br><span class="line">SELECT e.*,d.* </span><br><span class="line">FROM emp e LEFT OUTER JOIN dept d</span><br><span class="line">ON e.deptno = d.deptno;</span><br></pre></td></tr></table></figure>

<h4 id="RIGHT-OUTER-JOIN"><a href="#RIGHT-OUTER-JOIN" class="headerlink" title="RIGHT OUTER JOIN"></a>RIGHT OUTER JOIN</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 右连接</span><br><span class="line">SELECT e.*,d.* </span><br><span class="line">FROM emp e RIGHT OUTER JOIN dept d</span><br><span class="line">ON e.deptno = d.deptno;</span><br></pre></td></tr></table></figure>

<h4 id="FULL-OUTER-JOIN"><a href="#FULL-OUTER-JOIN" class="headerlink" title="FULL OUTER JOIN"></a>FULL OUTER JOIN</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT e.*,d.* </span><br><span class="line">FROM emp e FULL OUTER JOIN dept d</span><br><span class="line">ON e.deptno = d.deptno;</span><br></pre></td></tr></table></figure>

<h4 id="LEFT-SEMI-JOIN"><a href="#LEFT-SEMI-JOIN" class="headerlink" title="LEFT SEMI JOIN"></a>LEFT SEMI JOIN</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- LEFT SEMI JOIN（左半连接）是IN/EXISTS子查询的一种更高效的实现</span><br><span class="line">-- JOIN子句中右边的表只能在ON子句中设置过滤条件</span><br><span class="line">-- 查询结果只包含左边表的数据, 所以只能SELECT左表中的列</span><br><span class="line"></span><br><span class="line">-- 查询在纽约办公的所有员工信息</span><br><span class="line">SELECT emp.*</span><br><span class="line">FROM emp LEFT SEMI JOIN dept</span><br><span class="line">ON emp.deptno = dept.deptno AND dept.loc=&quot;NEW YORK&quot;;</span><br><span class="line"></span><br><span class="line">-- 上面的语句就等价于</span><br><span class="line">SELECT emp.* </span><br><span class="line">FROM emp</span><br><span class="line">WHERE emp.deptno IN (SELECT deptno FROM dept WHERE loc=&quot;NEW YORK&quot;);</span><br></pre></td></tr></table></figure>

<h4 id="JOIN"><a href="#JOIN" class="headerlink" title="JOIN"></a>JOIN</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 笛卡尔积连接, 性能消耗比较大, 如果在严格模式下(hive.mapred.mode = strict), Hive会阻止用户执行此操作</span><br><span class="line">SELECT * FROM emp JOIN dept;</span><br></pre></td></tr></table></figure>

<h3 id="本地模式"><a href="#本地模式" class="headerlink" title="本地模式"></a>本地模式</h3><p>在上文Demo语句中，大多数操作都会触发MapReduce，仅少部分不会触发，例如select * from emp limit 5就不会触发MapReduce，此时Hive只是简单的读取数据文件中的内容，然后格式化后进行输出。</p>
<p>在需要执行MapReduce的查询中，执行时间可能会很长，这时候可以选择开启本地模式。启用后，Hive将分析查询中每个map-reduce作业的大小，如果满足以下条件，则可以在本地运行它：</p>
<ol>
<li>作业的总输入大小低于hive.exec.mode.local.auto.inputbytes.max（默认为128MB）</li>
<li>map-tasks的总数小于hive.exec.mode.local.auto.tasks.max（默认为4）</li>
<li>所需的reduce任务总数为1或0</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 本地模式默认关闭, 需要手动开启此功能</span><br><span class="line">SET hive.exec.mode.local.auto=true;</span><br></pre></td></tr></table></figure>

<p>在下图中可以看到，当满足本地查询条件后，由于Demo数据集很小，再次执行涉及MapReduce操作的查询时（以左半连接查询在纽约办公的所有员工信息为例），可以看到速度有显著的提升。</p>
<p><img src="/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/1750162740273-576b6f80-326f-4660-a48c-d2121bfb214e.png"></p>
<p><img src="/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/1750162789438-d373eb41-e844-4179-96cc-e3a37506b517.png"></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL">LanguageManual DDL</a></p>
<p><a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Select">LanguageManual Select</a></p>
<p><a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Joins">LanguageManual Joins</a></p>
<p><a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+GroupBy">LanguageManual GroupBy</a></p>
<p><a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+SortBy">LanguageManual SortBy</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/TWfErsYIxN43f5Y-3z1gZQ">五万字 | Hive知识体系保姆级教程</a></p>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.</span> <span class="toc-text">Hive环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E5%B8%B8%E7%94%A8DDL%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.</span> <span class="toc-text">Hive常用DDL语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">2.1.</span> <span class="toc-text">数据库操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.</span> <span class="toc-text">表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E8%A1%A8"><span class="toc-number">2.2.1.</span> <span class="toc-text">内部表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E8%A1%A8"><span class="toc-number">2.2.2.</span> <span class="toc-text">外部表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E8%A1%A8"><span class="toc-number">2.2.3.</span> <span class="toc-text">分区表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%A1%B6%E8%A1%A8"><span class="toc-number">2.2.4.</span> <span class="toc-text">分桶表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%80%BE%E6%96%9C%E8%A1%A8"><span class="toc-number">2.2.5.</span> <span class="toc-text">倾斜表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E8%A1%A8"><span class="toc-number">2.2.6.</span> <span class="toc-text">临时表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.7.</span> <span class="toc-text">复制表结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CTAS%E5%BB%BA%E8%A1%A8"><span class="toc-number">2.2.8.</span> <span class="toc-text">CTAS建表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">2.2.9.</span> <span class="toc-text">修改删除表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.10.</span> <span class="toc-text">加载数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.11.</span> <span class="toc-text">导出数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E5%B8%B8%E7%94%A8DQL%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.</span> <span class="toc-text">Hive常用DQL语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.1.</span> <span class="toc-text">单表查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.2.</span> <span class="toc-text">多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#INNER-JOIN"><span class="toc-number">3.2.1.</span> <span class="toc-text">INNER JOIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LEFT-OUTER-JOIN"><span class="toc-number">3.2.2.</span> <span class="toc-text">LEFT OUTER JOIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RIGHT-OUTER-JOIN"><span class="toc-number">3.2.3.</span> <span class="toc-text">RIGHT OUTER JOIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FULL-OUTER-JOIN"><span class="toc-number">3.2.4.</span> <span class="toc-text">FULL OUTER JOIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LEFT-SEMI-JOIN"><span class="toc-number">3.2.5.</span> <span class="toc-text">LEFT SEMI JOIN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JOIN"><span class="toc-number">3.2.6.</span> <span class="toc-text">JOIN</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.3.</span> <span class="toc-text">本地模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&text=Hive基础（二）"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&title=Hive基础（二）"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&is_video=false&description=Hive基础（二）"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Hive基础（二）&body=Check out this article: https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&title=Hive基础（二）"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&title=Hive基础（二）"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&title=Hive基础（二）"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&title=Hive基础（二）"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&name=Hive基础（二）&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://h3rmesk1t.github.io/2025/06/17/Hive%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/&t=Hive基础（二）"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023-2025
    H3rmesk1t
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'H3rmesk1t/h3rmesk1t.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = '💬';
      var utterances_theme = 'github-light';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
